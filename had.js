f = (M) =>
  (g = (z) =>
    (M = M.map((r, y) =>
      r.map(
        (_, x) =>
          r.map(
            (v) =>
              (s += (h = (m) => (m ? -h(m & ~-m) : z ? v : M[i - 1][x]))(
                i++ & (z ? x : y)
              )),
            (i = s = 0)
          ) && s / i
      )
    )))(g());

const a = [
  [-10, -7, -3, -13, -9, -3, 0, 5],
  [-3, 4, -12, -6, -1, -15, 5, 9],
  [-8, -11, -12, -12, -14, -15, 0, -1],
  [-10, -9, -7, -13, -11, -7, 0, 4],
  [-3, 4, -12, -6, 1, -15, 7, 13],
  [-4, -11, -10, -10, -14, -14, 1, -1],
  [-10, -11, -10, -13, -13, -11, 0, 2],
  [-3, 3, -12, -6, 1, -15, 7, 1],
];
console.log(f(a));
